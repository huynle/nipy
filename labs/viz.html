<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Neuroimaging in Python &#8212; NIPY Documentation</title>
    
    <link rel="stylesheet" href="../_static/nipy.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.5.0.dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="nipy.labs.viz_tools.activation_maps.plot_map" href="generated/nipy.labs.viz_tools.activation_maps.plot_map.html" />
    <link rel="prev" title="Empirical null" href="enn.html" />
  <meta name="keywords" content="nipy, neuroimaging, python, neuroscience, time
				 series">

  </head>
  <body role="document">
<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
 <a href="../index.html">
  <img src="../_static/reggie2.png" alt="NIPY logo"  border="0" />
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="generated/nipy.labs.viz_tools.activation_maps.plot_map.html" title="nipy.labs.viz_tools.activation_maps.plot_map"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="enn.html" title="Empirical null"
             accesskey="P">previous</a> |</li>
  <li><a href="../index.html">NIPY home</a> |&nbsp;</li>

          <li class="nav-item nav-item-1"><a href="../documentation.html" >NIPY documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">NeuroSpin tools</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">

  
<h4> Site Navigation </h4>
  <ul>
    <li><a href="../documentation.html">Documentation</a></li>
    <li><a href="../devel/index.html">Development</a></li>
  </ul>

<h4> NIPY Community </h4>
  <ul class="simple">
    <li><a class="reference external"
	href="http://nipy.org/">Community Home</a></li>
    <li><a class="reference external"
	href="http://nipy.org/project-directory">NIPY Projects</a></li>
    <li><a class="reference external"
	href="https://mail.python.org/mailman/listinfo/neuroimaging">Mailing List</a></li>
    <li><a class="reference external"
	href="license.html">License</a></li>
  </ul>

<h4> Github repo </h4>
  <ul class="simple">
    <li><a class="reference external"
	href="http://github.com/nipy/nipy/">Nipy Github</a></li>
  </ul>

  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Plotting of activation maps</a><ul>
<li><a class="reference internal" href="#an-example">An example</a></li>
<li><a class="reference internal" href="#nipy-labs-viz-functions"><cite>nipy.labs.viz</cite> functions</a></li>
<li><a class="reference internal" href="#d-plotting-utilities">3D plotting utilities</a><ul>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="enn.html"
                        title="previous chapter">Empirical null</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="generated/nipy.labs.viz_tools.activation_maps.plot_map.html"
                        title="next chapter">nipy.labs.viz_tools.activation_maps.plot_map</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/labs/viz.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>

<div id="searchbox-ml" style="display: none">
  <h3>Search mailing list archive</h3>
  <script type="text/javascript">
    function mlsearch(curobj)
    {
    curobj.q.value="site:http://mail.python.org/pipermail/neuroimaging/ "+curobj.userquery.value
    }
  </script>
  <form action="http://www.google.com/search" method="get" onSubmit="mlsearch(this)">
    <input name="userquery" size="13" type="text" /> <input type="submit" value="Go" />
    <input name="q" type="hidden" />
  </form>
</div>
  
<div id="searchbox-site" style="display: none">
  <h3>Search this site</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="13" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    </p>
</div>
<script type="text/javascript">$('#searchbox-ml').show(0);</script>
<script type="text/javascript">$('#searchbox-site').show(0);</script>


        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="plotting-of-activation-maps">
<h1>Plotting of activation maps<a class="headerlink" href="#plotting-of-activation-maps" title="Permalink to this headline">¶</a></h1>
<p>The module <code class="xref py py-mod docutils literal"><span class="pre">nipy.labs.viz</span></code> provides functions to plot
visualization of activation maps in a non-interactive way.</p>
<p>2D cuts of an activation map can be plotted and superimposed on an
anatomical map using <a class="reference external" href="http://matplotlib.sourceforge.net">matplotlib</a>. In addition, <a class="reference external" href="http://code.enthought.com/projects/mayavi">Mayavi2</a> can be used to
plot 3D maps, using volumetric rendering. Some emphasis is made on
automatic choice of default parameters, such as cut coordinates, to give
a sensible view of a map in a purely automatic way, for instance to save
a summary of the output of a calculation.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The content of the module will change over time, as neuroimaging
volumetric data structures are used instead of plain numpy arrays.</p>
</div>
<div class="section" id="an-example">
<h2>An example<a class="headerlink" href="#an-example" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nipy.labs.viz</span> <span class="k">import</span> <span class="n">plot_map</span><span class="p">,</span> <span class="n">mni_sform</span><span class="p">,</span> <span class="n">coord_transform</span>

<span class="c1"># First, create a fake activation map: a 3D image in MNI space with</span>
<span class="c1"># a large rectangle of activation around Broca Area</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">mni_sform_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">mni_sform</span><span class="p">)</span>
<span class="c1"># Color an asymmetric rectangle around Broca area:</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="o">-</span><span class="mi">52</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">22</span>
<span class="n">x_map</span><span class="p">,</span> <span class="n">y_map</span><span class="p">,</span> <span class="n">z_map</span> <span class="o">=</span> <span class="n">coord_transform</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">mni_sform_inv</span><span class="p">)</span>
<span class="nb">map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">182</span><span class="p">,</span> <span class="mi">218</span><span class="p">,</span> <span class="mi">182</span><span class="p">))</span>
<span class="nb">map</span><span class="p">[</span><span class="n">x_map</span><span class="o">-</span><span class="mi">30</span><span class="p">:</span><span class="n">x_map</span><span class="o">+</span><span class="mi">30</span><span class="p">,</span> <span class="n">y_map</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span><span class="n">y_map</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="n">z_map</span><span class="o">-</span><span class="mi">10</span><span class="p">:</span><span class="n">z_map</span><span class="o">+</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># We use a masked array to add transparency to the parts that we are</span>
<span class="c1"># not interested in:</span>
<span class="n">thresholded_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_less</span><span class="p">(</span><span class="nb">map</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># And now, visualize it:</span>
<span class="n">plot_map</span><span class="p">(</span><span class="n">thresholded_map</span><span class="p">,</span> <span class="n">mni_sform</span><span class="p">,</span> <span class="n">cut_coords</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">),</span> <span class="n">vmin</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
<p>This creates the following image:</p>
<img alt="../_images/viz.png" src="../_images/viz.png" />
<p>The same plot can be obtained fully automatically, by letting
<a class="reference internal" href="generated/nipy.labs.viz_tools.activation_maps.plot_map.html#nipy.labs.viz_tools.activation_maps.plot_map" title="nipy.labs.viz_tools.activation_maps.plot_map"><code class="xref py py-func docutils literal"><span class="pre">plot_map()</span></code></a> find the activation threshold and the cut coordinates:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">plot_map</span><span class="p">(</span><span class="nb">map</span><span class="p">,</span> <span class="n">mni_sform</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In this simple example, the code will easily detect the bar as activation
and position the cut at the center of the bar.</p>
</div>
<div class="section" id="nipy-labs-viz-functions">
<h2><cite>nipy.labs.viz</cite> functions<a class="headerlink" href="#nipy-labs-viz-functions" title="Permalink to this headline">¶</a></h2>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="generated/nipy.labs.viz_tools.activation_maps.plot_map.html#nipy.labs.viz_tools.activation_maps.plot_map" title="nipy.labs.viz_tools.activation_maps.plot_map"><code class="xref py py-obj docutils literal"><span class="pre">plot_map</span></code></a>(map,&nbsp;affine[,&nbsp;cut_coords,&nbsp;anat,&nbsp;...])</td>
<td>Plot three cuts of a given activation map (Frontal, Axial, and Lateral)

:Parameters:

    <strong>map</strong> : 3D ndarray

        The activation map, as a 3D image.

    <strong>affine</strong> : 4x4 ndarray

        The affine matrix going from image voxel space to MNI space.

    <strong>cut_coords: None, int, or a tuple of floats</strong>

        The MNI coordinates of the point where the cut is performed, in
        MNI coordinates and order.
        If slicer is &#8216;ortho&#8217;, this should be a 3-tuple: (x, y, z)
        For slicer == &#8216;x&#8217;, &#8216;y&#8217;, or &#8216;z&#8217;, then these are the
        coordinates of each cut in the corresponding direction.
        If None or an int is given, then a maximally separated sequence (
        with exactly cut_coords elements if cut_coords is not None) of
        cut coordinates along the slicer axis is computed automatically

    <strong>anat</strong> : 3D ndarray or False, optional

        The anatomical image to be used as a background. If None, the
        MNI152 T1 1mm template is used. If False, no anat is displayed.

    <strong>anat_affine</strong> : 4x4 ndarray, optional

        The affine matrix going from the anatomical image voxel space to
        MNI space. This parameter is not used when the default
        anatomical is used, but it is compulsory when using an
        explicite anatomical image.

    <strong>slicer: {&#8216;ortho&#8217;, &#8216;x&#8217;, &#8216;y&#8217;, &#8216;z&#8217;}</strong>

        Choose the direction of the cuts. With &#8216;ortho&#8217; three cuts are
        performed in orthogonal directions

    <strong>figure</strong> : integer or matplotlib figure, optional

        Matplotlib figure used or its number. If None is given, a
        new figure is created.

    <strong>axes</strong> : matplotlib axes or 4 tuple of float: (xmin, ymin, width, height), optional

        The axes, or the coordinates, in matplotlib figure space,
        of the axes used to display the plot. If None, the complete
        figure is used.

    <strong>title</strong> : string, optional

        The title dispayed on the figure.

    <strong>threshold</strong> : a number, None, or &#8216;auto&#8217;

        If None is given, the maps are not thresholded.
        If a number is given, it is used to threshold the maps:
        values below the threshold are plotted as transparent. If
        auto is given, the threshold is determined magically by
        analysis of the map.

    <strong>annotate: boolean, optional</strong>

        If annotate is True, positions and left/right annotation
        are added to the plot.

    <strong>draw_cross: boolean, optional</strong>

        If draw_cross is True, a cross is drawn on the plot to
        indicate the cut plosition.

    <strong>do3d: {True, False or &#8216;interactive&#8217;}, optional</strong>

        If True, Mayavi is used to plot a 3D view of the
        map in addition to the slicing. If &#8216;interactive&#8217;, the
        3D visualization is displayed in an additional interactive
        window.

    <strong>threshold_3d:</strong>

        The threshold to use for the 3D view (if any). Defaults to
        the same threshold as that used for the 2D view.

    <strong>view_3d: tuple,</strong>

        The view used to take the screenshot: azimuth, elevation,
        distance and focalpoint, see the docstring of mlab.view.

    <strong>black_bg: boolean, optional</strong>

        If True, the background of the image is set to be black. If
        you whish to save figures with a black background, you
        will need to pass &#8220;facecolor=&#8217;k&#8217;, edgecolor=&#8217;k&#8217;&#8221; to pylab&#8217;s
        savefig.

    <strong>imshow_kwargs: extra keyword arguments, optional</strong>

        Extra keyword arguments passed to pylab.imshow

.. rubric:: Notes

Arrays should be passed in numpy convention: (x, y, z)
ordered.

Use masked arrays to create transparency:

    import numpy as np
    map = np.ma.masked_less(map, 0.5)
    plot_map(map, affine)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="d-plotting-utilities">
<h2>3D plotting utilities<a class="headerlink" href="#d-plotting-utilities" title="Permalink to this headline">¶</a></h2>
<p>The module <code class="xref py py-mod docutils literal"><span class="pre">nipy.labs.viz3d</span></code> can be used as helpers to
represent neuroimaging volumes with <a class="reference external" href="http://code.enthought.com/projects/mayavi">Mayavi2</a>.</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="generated/nipy.labs.viz_tools.maps_3d.plot_map_3d.html#nipy.labs.viz_tools.maps_3d.plot_map_3d" title="nipy.labs.viz_tools.maps_3d.plot_map_3d"><code class="xref py py-obj docutils literal"><span class="pre">plot_map_3d</span></code></a>(map,&nbsp;affine[,&nbsp;cut_coords,&nbsp;anat,&nbsp;...])</td>
<td>Plot a 3D volume rendering view of the activation, with an
outline of the brain.

:Parameters:

    <strong>map</strong> : 3D ndarray

        The activation map, as a 3D image.

    <strong>affine</strong> : 4x4 ndarray

        The affine matrix going from image voxel space to MNI space.

    <strong>cut_coords: 3-tuple of floats, optional</strong>

        The MNI coordinates of a 3D cursor to indicate a feature
        or a cut, in MNI coordinates and order.

    <strong>anat</strong> : 3D ndarray, optional

        The anatomical image to be used as a background. If None, the
        MNI152 T1 1mm template is used. If False, no anatomical
        image is used.

    <strong>anat_affine</strong> : 4x4 ndarray, optional

        The affine matrix going from the anatomical image voxel space to 
        MNI space. This parameter is not used when the default 
        anatomical is used, but it is compulsory when using an
        explicite anatomical image.

    <strong>threshold</strong> : float, optional

        The lower threshold of the positive activation. This
        parameter is used to threshold the activation map.

    <strong>offscreen: boolean, optional</strong>

        If True, Mayavi attempts to plot offscreen. Will work only
        with VTK &gt;= 5.2.

    <strong>vmin</strong> : float, optional

        The minimal value, for the colormap

    <strong>vmax</strong> : float, optional

        The maximum value, for the colormap

    <strong>cmap</strong> : a callable, or a pylab colormap

        A callable returning a (n, 4) array for n values between
        0 and 1 for the colors. This can be for instance a pylab
        colormap.

.. rubric:: Notes

If you are using a VTK version below 5.2, there is no way to
avoid opening a window during the rendering under Linux. This is
necessary to use the graphics card for the rendering. You must
maintain this window on top of others and on the screen.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/nipy.labs.viz_tools.maps_3d.plot_anat_3d.html#nipy.labs.viz_tools.maps_3d.plot_anat_3d" title="nipy.labs.viz_tools.maps_3d.plot_anat_3d"><code class="xref py py-obj docutils literal"><span class="pre">plot_anat_3d</span></code></a>([anat,&nbsp;anat_affine,&nbsp;scale,&nbsp;...])</td>
<td>3D anatomical display

:Parameters:

    <strong>skull_percentile</strong> : float, optional

        The percentile of the values in the image that delimit the skull from
        the outside of the brain. The smaller the fraction of you field of view
        is occupied by the brain, the larger this value should be.

    <strong>wm_percentile</strong> : float, optional

        The percentile of the values in the image that delimit the white matter
        from the grey matter. Typical this is skull_percentile + 1</td>
</tr>
</tbody>
</table>
<p>For more versatile visualizations the core idea is that given a 3D map
and an affine, the data is exposed in Mayavi as a volumetric source, with
world space coordinates corresponding to figure coordinates.
Visualization modules can be applied on this data source as explained in
the <a class="reference external" href="http://code.enthought.com/projects/mayavi/docs/development/html/mayavi/mlab.html#assembling-pipelines-with-mlab">Mayavi manual</a></p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="generated/nipy.labs.viz_tools.maps_3d.affine_img_src.html#nipy.labs.viz_tools.maps_3d.affine_img_src" title="nipy.labs.viz_tools.maps_3d.affine_img_src"><code class="xref py py-obj docutils literal"><span class="pre">affine_img_src</span></code></a>(data,&nbsp;affine[,&nbsp;scale,&nbsp;name,&nbsp;...])</td>
<td>Make a Mayavi source defined by a 3D array and an affine, for
wich the voxel of the 3D array are mapped by the affine.

:Parameters:

    <strong>data: 3D ndarray</strong>

        The data arrays

    <strong>affine: (4 x 4) ndarray</strong>

        The (4 x 4) affine matrix relating voxels to world
        coordinates.

    <strong>scale: float, optional</strong>

        An optional addition scaling factor.

    <strong>name: string, optional</strong>

        The name of the Mayavi source created.

    <strong>reverse_x: boolean, optional</strong>

        Reverse the x (lateral) axis. Useful to compared with
        images in radiologic convention.

.. rubric:: Notes

The affine should be diagonal.</td>
</tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="generated/nipy.labs.viz_tools.activation_maps.plot_map.html" title="nipy.labs.viz_tools.activation_maps.plot_map"
             >next</a> |</li>
        <li class="right" >
          <a href="enn.html" title="Empirical null"
             >previous</a> |</li>
  <li><a href="../index.html">NIPY home</a> |&nbsp;</li>

          <li class="nav-item nav-item-1"><a href="../documentation.html" >NIPY documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >NeuroSpin tools</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2005-2017, Neuroimaging in Python team.
      Last updated on Mar 17, 2017.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.1.
    </div>
  </body>
</html>